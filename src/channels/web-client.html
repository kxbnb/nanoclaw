<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NanoClaw</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0a0a0a; color: #e0e0e0; height: 100vh; display: flex; flex-direction: column; }
  #header { padding: 12px 16px; background: #141414; border-bottom: 1px solid #222; font-weight: 600; display: flex; align-items: center; gap: 8px; }
  #header .dot { width: 8px; height: 8px; border-radius: 50%; background: #555; }
  #header .dot.connected { background: #4ade80; }
  #messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 8px; }
  .msg { max-width: 75%; padding: 10px 14px; border-radius: 12px; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word; font-size: 14px; }
  .msg.user { align-self: flex-end; background: #2563eb; color: #fff; border-bottom-right-radius: 4px; }
  .msg.assistant { align-self: flex-start; background: #1e1e1e; border: 1px solid #333; border-bottom-left-radius: 4px; }
  #typing { padding: 4px 16px; font-size: 13px; color: #888; min-height: 24px; }
  #input-area { padding: 12px 16px; background: #141414; border-top: 1px solid #222; display: flex; gap: 8px; }
  #input { flex: 1; padding: 10px 14px; border-radius: 8px; border: 1px solid #333; background: #1e1e1e; color: #e0e0e0; font-size: 14px; outline: none; font-family: inherit; }
  #input:focus { border-color: #2563eb; }
  #send { padding: 10px 20px; border-radius: 8px; border: none; background: #2563eb; color: #fff; font-size: 14px; cursor: pointer; font-family: inherit; }
  #send:hover { background: #1d4ed8; }
  #send:disabled { opacity: 0.5; cursor: default; }
</style>
</head>
<body>
<div id="header"><span class="dot" id="dot"></span> NanoClaw</div>
<div id="messages"></div>
<div id="typing"></div>
<div id="input-area">
  <input id="input" type="text" placeholder="Type a message..." autocomplete="off" />
  <button id="send">Send</button>
</div>
<script>
(function() {
  const messages = document.getElementById('messages');
  const typing = document.getElementById('typing');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('send');
  const dot = document.getElementById('dot');
  let ws, reconnectDelay = 500;

  function connect() {
    const proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
    ws = new WebSocket(proto + '//' + location.host + '/ws');
    ws.onopen = function() {
      dot.classList.add('connected');
      reconnectDelay = 500;
    };
    ws.onclose = function() {
      dot.classList.remove('connected');
      setTimeout(connect, reconnectDelay);
      reconnectDelay = Math.min(reconnectDelay * 2, 10000);
    };
    ws.onmessage = function(e) {
      try {
        const data = JSON.parse(e.data);
        if (data.type === 'message') {
          addMessage(data.text, 'assistant');
        } else if (data.type === 'typing') {
          typing.textContent = data.isTyping ? 'nano is typing\u2026' : '';
        }
      } catch {}
    };
  }

  function addMessage(text, role) {
    const el = document.createElement('div');
    el.className = 'msg ' + role;
    el.textContent = text;
    messages.appendChild(el);
    messages.scrollTop = messages.scrollHeight;
  }

  function send() {
    const text = input.value.trim();
    if (!text || !ws || ws.readyState !== WebSocket.OPEN) return;
    ws.send(JSON.stringify({ type: 'message', text: text }));
    addMessage(text, 'user');
    input.value = '';
  }

  sendBtn.onclick = send;
  input.onkeydown = function(e) { if (e.key === 'Enter') send(); };
  connect();
})();
</script>
</body>
</html>
